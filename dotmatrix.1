.TH DOTMATRIX 1 "January 2026" "dotmatrix 0.1.0" "User Commands"
.SH NAME
dotmatrix \- dotfile management and versioning tool
.SH SYNOPSIS
.B dotmatrix
[\fB\-v\fR|\fB\-\-verbose\fR]
.I command
[\fIoptions\fR]
.SH DESCRIPTION
.B dotmatrix
is a dotfile management tool that indexes configuration files where they live,
without using symlinks. It provides version control through git integration
and supports two backup modes: incremental (content-addressed) and archive (tarballs).
.SH GLOBAL OPTIONS
.TP
.BR \-v ", " \-\-verbose
Increase verbosity. Use \fB\-v\fR for verbose output, \fB\-vv\fR for debug output.
.TP
.BR \-h ", " \-\-help
Print help information.
.TP
.BR \-V ", " \-\-version
Print version information.
.SH COMMANDS
.SS init
Initialize dotmatrix configuration and storage directories. Creates config file,
index, and git repository. Prompts for git identity if not configured globally.
.SS add \fIpatterns\fR...
Add file patterns to the tracking list.
.PP
.RS
.nf
dotmatrix add ~/.bashrc
dotmatrix add ~/.config/nvim/**
dotmatrix add /etc/nginx/nginx.conf
.fi
.RE
.SS remove \fIpatterns\fR...
Remove file patterns from the tracking list.
.SS scan [\fB\-\-yes\fR]
Scan all tracked files and update the index with current metadata (hash, size, mtime).
.TP
.BR \-y ", " \-\-yes
Auto-confirm cleanup of orphaned entries.
.SS backup [\fB\-m\fR \fImessage\fR]
Backup tracked files to storage. Uses incremental or archive mode based on config.
.TP
.BR \-m ", " \-\-message " " \fImessage\fR
Commit message for git (if enabled).
.SS restore [\fIoptions\fR]
Restore files from backup. Shows comparison view and requires confirmation.
.TP
.BR \-\-dry\-run
Show what would be restored without making changes.
.TP
.BR \-\-diff
Show file differences for each file.
.TP
.BR \-y ", " \-\-yes
Auto-confirm restore (still creates safety backup).
.TP
.BR \-f ", " \-\-file " " \fIpattern\fR
Restore only files matching pattern.
.TP
.BR \-c ", " \-\-commit " " \fIhash\fR
Restore from specific git commit.
.TP
.BR \-\-extract\-to " " \fIdirectory\fR
Extract all files to specified directory (preserving structure).
Useful for reviewing before overwriting originals.
.TP
.BR \-\-remap " " \fIold=new\fR
Remap paths during restore. Format: /old/path=/new/path.
Useful for distro-hopping or username changes.
.SS status [\fIoptions\fR]
Show status of tracked files compared to last backup.
.TP
.BR \-a ", " \-\-all
Show all files including unchanged.
.TP
.BR \-q ", " \-\-quick
Quick mode: compare by size/mtime only (skip hash calculation).
.TP
.BR \-\-json
Output in JSON format for scripting.
.SS list
List all tracked file patterns and exclude patterns.
.SS tui
Launch interactive terminal user interface. Provides keyboard-driven navigation
for browsing tracked files, viewing status, and managing patterns.
.PP
.B Key bindings:
.RS
.TP
.B j/k, Up/Down
Navigate file list
.TP
.B Tab
Switch between Status/Browse/Add modes
.TP
.B Space
Toggle selection
.TP
.B Enter
Toggle tracking (add/remove pattern)
.TP
.B a
Add new pattern manually
.TP
.B d
Remove selected from index
.TP
.B r
Refresh file list
.TP
.B ?
Show help
.TP
.B q
Quit
.RE
.SH CONFIGURATION
Configuration is stored in \fI~/.config/dotmatrix/config.toml\fR:
.PP
.RS
.nf
git_enabled = true
backup_mode = "incremental"  # default mode

tracked_files = [
    "~/.bashrc",
    "~/.zshrc",
    # Per-pattern mode override
    { path = "~/.config/nvim/**", mode = "archive" },
]

exclude = [
    "**/*.log",
    "**/node_modules/**",
]
.fi
.RE
.SS BACKUP MODES
.TP
.B incremental
Files are stored by SHA256 hash in content-addressed storage.
Provides automatic deduplication. Best for frequent backups.
.TP
.B archive
Files are stored as compressed tarballs with timestamps.
Best for occasional snapshots.
.PP
Patterns can override the default mode by using the object syntax:
.RS
.nf
{ path = "~/.config/nvim/**", mode = "archive" }
.fi
.RE
.SH FILES
.TP
.I ~/.config/dotmatrix/config.toml
Configuration file.
.TP
.I ~/.local/share/dotmatrix/index.json
File metadata index.
.TP
.I ~/.local/share/dotmatrix/storage/
Content-addressed backup storage (incremental mode).
.TP
.I ~/.local/share/dotmatrix/archives/
Tarball backup storage (archive mode).
.TP
.I ~/.local/share/dotmatrix/.git/
Git repository for version control.
.TP
.I ~/.dotmatrix-restore-backup-*/
Safety backups created before restore operations.
.SH PATTERN MATCHING
.B dotmatrix
supports glob patterns for file matching:
.PP
.RS
.nf
~/.bashrc              # Single file
~/.config/*            # All files in directory
~/.config/**           # All files recursively
~/.config/**/*.lua     # All .lua files recursively
.fi
.RE
.SH EXAMPLES
.SS Basic workflow
.PP
.RS
.nf
# Initialize
dotmatrix init

# Add files to track
dotmatrix add ~/.bashrc ~/.zshrc

# Scan to index files
dotmatrix scan

# Create backup
dotmatrix backup -m "Initial backup"

# Check status
dotmatrix status

# Restore (interactive)
dotmatrix restore
.fi
.RE
.SS Preview restore changes
.PP
.RS
.nf
dotmatrix restore --dry-run --diff
.fi
.RE
.SS Restore to different location
.PP
.RS
.nf
# Extract to staging directory
dotmatrix restore --extract-to ~/restored

# Remap paths for new username
dotmatrix restore --remap /home/olduser=/home/newuser
.fi
.RE
.SS Verbose output
.PP
.RS
.nf
dotmatrix -v backup
dotmatrix -vv status
.fi
.RE
.SS Interactive TUI
.PP
.RS
.nf
dotmatrix tui
.fi
.RE
.SH EXIT STATUS
.TP
.B 0
Success.
.TP
.B 1
Error occurred.
.SH SEE ALSO
.BR git (1),
.BR rsync (1)
.SH BUGS
Report bugs at: https://github.com/Woofson/dotmatrix/issues
.SH AUTHOR
Woofson <https://github.com/Woofson>
